[
  {
    "id": "d51c3511.6ec088",
    "type": "homekit-service",
    "z": "86138410.5a4068",
    "isParent": true,
    "bridge": "8e4d0c4d.ceb44",
    "parentService": "",
    "name": "Vacuum",
    "serviceName": "Fanv2",
    "topic": "",
    "filter": false,
    "manufacturer": "Default Manufacturer",
    "model": "Default Model",
    "serialNo": "Default Serial Number",
    "characteristicProperties": "{\n    \"RotationSpeed\":{\n        \"minStep\":1,\n        \"maxValue\":100, \n        \"minValue\":0\n    },\n    \"SwingMode\": {\n        \"maxValue\":1, \n        \"minValue\":0\n    },\n    \"LockPhysicalControls\": {\n        \"maxValue\":1, \n        \"minValue\":0\n    }\n} ",
    "x": 960,
    "y": 660,
    "wires": [
      [
        "a21a6d14.644da"
      ]
    ]
  },
  {
    "id": "fedf1973.fe1478",
    "type": "homekit-service",
    "z": "86138410.5a4068",
    "isParent": false,
    "bridge": "8e4d0c4d.ceb44",
    "parentService": "d51c3511.6ec088",
    "name": "Battery",
    "serviceName": "BatteryService",
    "topic": "",
    "filter": false,
    "manufacturer": "Default Manufacturer",
    "model": "Default Model",
    "serialNo": "Default Serial Number",
    "characteristicProperties": "{}",
    "x": 960,
    "y": 480,
    "wires": [
      []
    ]
  },
  {
    "id": "df5d486d.19d838",
    "type": "switch",
    "z": "86138410.5a4068",
    "name": "state",
    "property": "payload.key",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "batteryLevel",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "charging",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "state",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "fanSpeed",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "in_cleaning",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "cleanTime",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 6,
    "x": 490,
    "y": 620,
    "wires": [
      [
        "2a34a041.08601"
      ],
      [
        "b7b96fe2.eacc3"
      ],
      [
        "eb1eacc3.681ae",
        "b7b96fe2.eacc3"
      ],
      [
        "6939b50f.81d27c"
      ],
      [
        "ca4e7253.fba2d"
      ],
      [
        "8cf0d079.52751"
      ]
    ]
  },
  {
    "id": "b7b96fe2.eacc3",
    "type": "function",
    "z": "86138410.5a4068",
    "name": "ChargingState",
    "func": "var key = msg.payload.key;\nvar value = msg.payload.value;\n\nmsg.payload = {};\n\nif ('charging' === key) {\n    msg.payload.ChargingState = value?1:0\n    \n} else if ('state' === key) {\n    msg.payload.ChargingState = value==='charging'?1:0;\n} \n\nnode.status({fill:msg.payload.ChargingState?\"green\":\"red\",shape:\"dot\",text:msg.payload.ChargingState?'true':'false'})\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 760,
    "y": 540,
    "wires": [
      [
        "fedf1973.fe1478"
      ]
    ]
  },
  {
    "id": "2a34a041.08601",
    "type": "function",
    "z": "86138410.5a4068",
    "name": "BatteryLevel",
    "func": "var value = msg.payload.value;\n\nmsg.payload = {\n    \"BatteryLevel\": value,\n    \"StatusLowBattery\": value < 15 ? 1 : 0\n}\n\nnode.status({fill:value < 15?\"red\":\"green\",shape:\"dot\",text:value+'%'})\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 750,
    "y": 480,
    "wires": [
      [
        "fedf1973.fe1478"
      ]
    ]
  },
  {
    "id": "5488340a.3a740c",
    "type": "miio-roborock-event",
    "z": "86138410.5a4068",
    "name": "",
    "server": "a5093fc7.a6ab8",
    "eventTypes": [
      "state",
      "batteryLevel",
      "cleanTime",
      "cleanArea",
      "error",
      "map_present",
      "in_cleaning",
      "in_returning",
      "in_fresh_state",
      "lab_status",
      "fanSpeed",
      "dnd_enabled"
    ],
    "outputAtStartup": true,
    "x": 300,
    "y": 620,
    "wires": [
      [
        "df5d486d.19d838"
      ]
    ]
  },
  {
    "id": "ca4e7253.fba2d",
    "type": "function",
    "z": "86138410.5a4068",
    "name": "On",
    "func": "var value = msg.payload.value;\n\nmsg.payload = {};\nmsg.payload.Active = value;\nmsg.payload.RotationSpeed = msg.status.fanSpeed;\nmsg.payload.SwingMode = msg.status.fanSpeed==105;\n\nnode.status({fill:value?\"green\":\"red\",shape:\"dot\",text:value?'true':'false'})\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 730,
    "y": 720,
    "wires": [
      [
        "d51c3511.6ec088"
      ]
    ]
  },
  {
    "id": "a21a6d14.644da",
    "type": "miio-roborock-command",
    "z": "86138410.5a4068",
    "name": "",
    "server": "a5093fc7.a6ab8",
    "command_name": "homekit",
    "command": "homekit",
    "commandType": "homekit_cmd",
    "payload": "payload",
    "payloadType": "msg",
    "x": 1100,
    "y": 660,
    "wires": [
      [
        "9ded7f83.d181c"
      ]
    ]
  },
  {
    "id": "6939b50f.81d27c",
    "type": "function",
    "z": "86138410.5a4068",
    "name": "RotationSpeed",
    "func": "var value = msg.payload.value;\n\nmsg.payload = {};\nmsg.payload.RotationSpeed = msg.status.fanSpeed;\nmsg.payload.SwingMode = msg.status.fanSpeed==105;\n\nnode.status({fill:\"green\",shape:\"dot\",text:msg.status.fanSpeed==105?'wet cleaning':value+'%'});\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 760,
    "y": 660,
    "wires": [
      [
        "d51c3511.6ec088"
      ]
    ]
  },
  {
    "id": "eb1eacc3.681ae",
    "type": "function",
    "z": "86138410.5a4068",
    "name": "by state",
    "func": "var value = msg.payload.value;\n\nmsg.payload = {};\nmsg.payload.LockPhysicalControls = value==='returning'?1:0;\n\nif ([\"charging\", \"error\", \"charger-offline\", \"charger-error\", \"waiting\", \"paused\", \"shutting-down\", \"updating\", \"docking\", \"returning\"].indexOf(value)>=0) {\n    msg.payload.Active = 0;\n} \n\nnode.status({fill:\"green\",shape:\"dot\",text:value})\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 740,
    "y": 600,
    "wires": [
      [
        "d51c3511.6ec088"
      ]
    ]
  },
  {
    "id": "9ded7f83.d181c",
    "type": "switch",
    "z": "86138410.5a4068",
    "name": "app_stop",
    "property": "request.command",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "app_stop",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1240,
    "y": 660,
    "wires": [
      [
        "d6adce26.b9adb"
      ]
    ]
  },
  {
    "id": "d6adce26.b9adb",
    "type": "miio-roborock-command",
    "z": "86138410.5a4068",
    "name": "",
    "server": "a5093fc7.a6ab8",
    "command_name": "Start charging",
    "command": "app_charge",
    "commandType": "vacuum_cmd",
    "payload": "payload",
    "payloadType": "msg",
    "x": 1400,
    "y": 660,
    "wires": [
      []
    ]
  },
  {
    "id": "8cf0d079.52751",
    "type": "switch",
    "z": "86138410.5a4068",
    "name": "cleanTime > 40 min",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "gt",
        "v": "2400",
        "vt": "num"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 770,
    "y": 780,
    "wires": [
      [
        "aaab1022.0b6be"
      ]
    ]
  },
  {
    "id": "aaab1022.0b6be",
    "type": "miio-roborock-command",
    "z": "86138410.5a4068",
    "name": "",
    "server": "a5093fc7.a6ab8",
    "command_name": "Stop vacuuming",
    "command": "app_stop",
    "commandType": "vacuum_cmd",
    "payload": "payload",
    "payloadType": "msg",
    "x": 980,
    "y": 780,
    "wires": [
      [
        "7c4e17c3.657c68"
      ]
    ]
  },
  {
    "id": "7c4e17c3.657c68",
    "type": "miio-roborock-command",
    "z": "86138410.5a4068",
    "name": "",
    "server": "a5093fc7.a6ab8",
    "command_name": "Send findme",
    "command": "find_me",
    "commandType": "vacuum_cmd",
    "payload": "payload",
    "payloadType": "msg",
    "x": 1150,
    "y": 780,
    "wires": [
      []
    ]
  },
  {
    "id": "8e4d0c4d.ceb44",
    "type": "homekit-bridge",
    "z": "",
    "bridgeName": "Node-Red-macos2",
    "pinCode": "111-11-111",
    "port": "",
    "allowInsecureRequest": false,
    "manufacturer": "Default Manufacturer",
    "model": "Default Model",
    "serialNo": "Default Serial Number",
    "customMdnsConfig": false,
    "mdnsMulticast": true,
    "mdnsInterface": "",
    "mdnsPort": "",
    "mdnsIp": "",
    "mdnsTtl": "",
    "mdnsLoopback": true,
    "mdnsReuseAddr": true
  },
  {
    "id": "a5093fc7.a6ab8",
    "type": "miio-roborock-server",
    "z": "",
    "name": "Vacuum",
    "ip": "192.168.1.18",
    "token": "6c5469443267644b756c7a4f58763965",
    "polling": "5"
  }
]